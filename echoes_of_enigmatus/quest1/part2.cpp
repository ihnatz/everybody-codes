#include <vector>
#include <iostream>
#include <ranges>
#include <sstream>
#include <string_view>

constexpr std::array<std::string_view, 100> input{
    "A=4097 B=6360 C=5150 X=526385334 Y=5685865355 Z=19498744502 M=83",
    "A=8622 B=6182 C=8571 X=836198538 Y=1794772282 Z=72081339899 M=138",
    "A=3645 B=5146 C=5942 X=964951891 Y=7430081911 Z=94458070776 M=183",
    "A=2022 B=6725 C=5759 X=626766945 Y=6253771761 Z=68323677739 M=62",
    "A=2076 B=8011 C=9902 X=396705054 Y=7430909594 Z=84549961682 M=78",
    "A=2728 B=9112 C=5329 X=562206779 Y=7218917261 Z=31317611864 M=168",
    "A=3929 B=7439 C=9005 X=294237397 Y=7010508239 Z=11315717229 M=95",
    "A=9974 B=7435 C=7639 X=719589281 Y=1150695828 Z=34962337972 M=116",
    "A=8240 B=8754 C=6509 X=408902031 Y=2731561118 Z=19361722355 M=178",
    "A=3921 B=6460 C=9793 X=875493382 Y=8025420069 Z=28898093468 M=154",
    "A=7538 B=7709 C=6627 X=329666810 Y=1771731099 Z=47245328697 M=180",
    "A=7076 B=5723 C=9750 X=182903053 Y=8544386049 Z=59266772057 M=199",
    "A=7339 B=6869 C=5535 X=434208702 Y=9855631818 Z=11463108532 M=88",
    "A=9902 B=5344 C=8433 X=924850552 Y=1924974731 Z=67838262305 M=76",
    "A=9114 B=6136 C=5645 X=166557264 Y=2922545120 Z=16819362605 M=180",
    "A=8355 B=3125 C=7879 X=673783969 Y=9901472435 Z=59321869298 M=189",
    "A=9123 B=9457 C=9407 X=352343351 Y=5104834154 Z=21543279802 M=107",
    "A=2271 B=4131 C=7583 X=289355612 Y=1188977331 Z=63384718815 M=118",
    "A=7512 B=8062 C=7143 X=895691795 Y=7525843256 Z=30456259279 M=140",
    "A=4547 B=3015 C=7316 X=352646029 Y=6424744097 Z=97027194135 M=128",
    "A=3143 B=5325 C=9646 X=272680318 Y=9681462283 Z=44529165704 M=93",
    "A=8896 B=9056 C=9222 X=904722178 Y=3422630301 Z=96753289096 M=197",
    "A=5641 B=6670 C=7731 X=102884132 Y=9577172656 Z=36080491908 M=189",
    "A=5365 B=6004 C=8288 X=804451812 Y=5484218294 Z=12570908091 M=57",
    "A=8207 B=6022 C=9157 X=485976319 Y=4893480923 Z=68590633228 M=71",
    "A=5877 B=7006 C=6415 X=138911216 Y=7898913624 Z=95235607623 M=191",
    "A=6600 B=4473 C=5840 X=570545747 Y=9511290686 Z=56659466627 M=109",
    "A=6620 B=4415 C=7368 X=439341107 Y=9137952449 Z=30007623702 M=182",
    "A=5300 B=5395 C=8906 X=297494917 Y=3391696663 Z=87065886694 M=184",
    "A=5932 B=9325 C=5916 X=813976496 Y=4477991093 Z=14640111087 M=108",
    "A=3970 B=4554 C=7726 X=695921405 Y=2451113967 Z=70417794086 M=72",
    "A=9680 B=9955 C=9643 X=177410191 Y=7761660644 Z=79656696972 M=94",
    "A=8571 B=5829 C=7981 X=325528000 Y=5871869759 Z=22460545639 M=66",
    "A=2457 B=7259 C=8829 X=189084984 Y=1762416674 Z=45410819198 M=85",
    "A=7603 B=4776 C=8279 X=216860462 Y=7840854842 Z=36424882077 M=56",
    "A=3431 B=3251 C=9484 X=883726427 Y=8746424191 Z=21548329974 M=136",
    "A=8165 B=7486 C=8158 X=120127739 Y=7217561875 Z=78809104589 M=173",
    "A=8844 B=9928 C=9170 X=718009079 Y=6386513294 Z=74029237040 M=177",
    "A=7975 B=6025 C=8942 X=934265034 Y=6678607155 Z=29885213694 M=164",
    "A=8733 B=8663 C=6162 X=369723396 Y=2294010795 Z=72770558899 M=94",
    "A=5610 B=6386 C=5428 X=118024139 Y=4853346806 Z=54831740285 M=60",
    "A=7894 B=7163 C=9529 X=658314663 Y=4519030133 Z=62187917345 M=71",
    "A=5180 B=6236 C=9166 X=982060285 Y=5595568117 Z=96532830494 M=127",
    "A=3457 B=6991 C=8168 X=152462079 Y=2768147566 Z=44295797431 M=120",
    "A=5282 B=6421 C=5291 X=949607576 Y=4731765517 Z=19253715780 M=51",
    "A=6287 B=7836 C=9556 X=974629758 Y=4380748731 Z=24449332046 M=87",
    "A=8126 B=9092 C=7071 X=541601927 Y=2188441900 Z=36116152601 M=113",
    "A=5594 B=7420 C=6210 X=226720700 Y=5824843456 Z=66110046396 M=154",
    "A=5656 B=8818 C=5224 X=186359599 Y=7533074398 Z=88532531983 M=91",
    "A=9191 B=9273 C=5955 X=960155008 Y=5112553964 Z=77731814535 M=55",
    "A=5230 B=5137 C=7262 X=233057547 Y=5272166229 Z=94668082638 M=88",
    "A=7528 B=3566 C=8709 X=203600667 Y=4102827825 Z=20555316545 M=196",
    "A=9481 B=9707 C=7016 X=953542800 Y=3311835111 Z=30736717455 M=193",
    "A=8400 B=8330 C=9933 X=908186107 Y=1856149865 Z=75965149296 M=130",
    "A=4472 B=7553 C=6992 X=126701518 Y=2611380906 Z=44754372016 M=100",
    "A=2600 B=7752 C=9647 X=304657740 Y=2318513459 Z=39880922912 M=99",
    "A=6718 B=9268 C=5041 X=531909827 Y=7104225150 Z=22420178622 M=108",
    "A=4149 B=3713 C=9887 X=711018140 Y=9792909255 Z=34353865549 M=172",
    "A=3522 B=4408 C=7337 X=562169430 Y=4882976313 Z=47225944393 M=166",
    "A=3612 B=9680 C=9526 X=832579590 Y=6433121624 Z=51566926952 M=115",
    "A=8690 B=6475 C=8376 X=129659842 Y=6466448636 Z=11037268125 M=55",
    "A=4723 B=4407 C=5693 X=242479779 Y=7443243307 Z=33583523237 M=117",
    "A=8242 B=7763 C=7329 X=287525593 Y=2764228815 Z=71764760607 M=61",
    "A=5517 B=9844 C=8411 X=764582171 Y=4363506093 Z=45461565585 M=89",
    "A=5117 B=7046 C=9866 X=616391444 Y=7087976991 Z=93629728821 M=78",
    "A=9855 B=9430 C=9824 X=211511927 Y=9689409376 Z=77691817951 M=72",
    "A=9375 B=6048 C=9379 X=481086767 Y=6785797637 Z=61245349864 M=173",
    "A=6931 B=8829 C=8640 X=455506131 Y=6397271018 Z=23401859112 M=88",
    "A=2273 B=9454 C=8354 X=877700372 Y=5288778027 Z=33864948302 M=120",
    "A=7105 B=5010 C=5740 X=197610683 Y=4912996807 Z=71573367250 M=193",
    "A=6417 B=3590 C=7833 X=504018716 Y=8898240487 Z=26348510270 M=55",
    "A=8060 B=7654 C=7119 X=796809411 Y=1843555856 Z=63375430380 M=120",
    "A=2370 B=5819 C=9086 X=118012748 Y=5378730897 Z=22614938363 M=125",
    "A=6475 B=9403 C=5520 X=120978796 Y=8430967196 Z=59691474961 M=169",
    "A=8648 B=4545 C=5927 X=674882432 Y=6504151816 Z=52923026889 M=56",
    "A=6662 B=7015 C=7594 X=398034088 Y=4402887594 Z=61366080947 M=117",
    "A=7466 B=6999 C=9211 X=263612615 Y=6286571086 Z=11282792651 M=125",
    "A=3713 B=3515 C=7196 X=198927409 Y=5899385584 Z=96090098423 M=106",
    "A=6337 B=5635 C=6275 X=874991135 Y=4866780012 Z=12877372949 M=92",
    "A=8402 B=4496 C=8637 X=772015347 Y=3609308750 Z=85587666405 M=122",
    "A=7977 B=7557 C=9446 X=189050212 Y=9558607599 Z=69947796987 M=193",
    "A=7493 B=9692 C=7172 X=504338837 Y=4744275104 Z=44855393648 M=183",
    "A=7774 B=9833 C=7935 X=669672873 Y=5605519902 Z=30102274652 M=51",
    "A=6625 B=3825 C=9658 X=558017194 Y=4842634035 Z=16725693393 M=75",
    "A=9539 B=8126 C=5701 X=310033589 Y=8575944342 Z=30495630214 M=137",
    "A=2602 B=3175 C=6573 X=488469720 Y=4836479910 Z=11494084645 M=167",
    "A=3303 B=3427 C=8785 X=975624253 Y=5274421287 Z=63879486486 M=163",
    "A=4964 B=9495 C=7312 X=838563712 Y=2765137914 Z=96286030209 M=104",
    "A=5021 B=4892 C=8430 X=877240623 Y=6681744922 Z=40141084738 M=130",
    "A=2482 B=9476 C=6997 X=570279183 Y=2439933092 Z=93960182826 M=66",
    "A=2918 B=9415 C=5586 X=777659398 Y=5497068132 Z=17257093161 M=72",
    "A=4877 B=4737 C=8201 X=151980222 Y=3872329585 Z=95156866536 M=61",
    "A=2670 B=4434 C=9567 X=178559562 Y=6110928961 Z=29629425608 M=70",
    "A=4836 B=3949 C=7456 X=740626483 Y=1224102583 Z=51576297601 M=175",
    "A=6538 B=9868 C=7641 X=658458382 Y=6745555980 Z=21278502484 M=81",
    "A=9359 B=7711 C=5249 X=668202285 Y=5540265853 Z=55310298431 M=64",
    "A=7043 B=4354 C=8533 X=174120102 Y=1152419768 Z=23596107563 M=57",
    "A=7884 B=3874 C=6539 X=693824218 Y=8983731994 Z=62819647166 M=131",
    "A=8153 B=4491 C=6100 X=245388192 Y=1293558672 Z=61673713587 M=140",
    "A=3737 B=4303 C=5710 X=324998044 Y=3072130269 Z=65321832259 M=72",
};

long mpow(long base, long exp, long mod) {
    long r = 1;
    base = base % mod;
    while (exp > 0) {
        if (exp % 2 == 1) {
            r = (r * base) % mod;
        }
        exp = exp >> 1;
        base = (base * base) % mod;
    }
    return r;
}

long eni(long n, long exp, long mod) {
    std::string s = "";
    long rem = 1;
    for (long i = 0; i < exp; i++) {
        rem = rem * n % mod;
        s = std::to_string(rem) + s;
    }
    return std::stol(s);
}


long longEmi(long n, long exp, long mod) {
    if (exp < 5) {
        return eni(n, exp, mod);
    }

    std::vector<long> rems(5);

    long preLast = mpow(n, exp - 4, mod);
    rems[0] = preLast;
    for (long i = 1; i < 5; ++i) {
        preLast = preLast * n % mod;
        rems[i] = preLast;
    }

    std::ostringstream result;
    for (const auto i : std::views::reverse(rems)) {
        result << i;
    }

    return std::stol(result.str());
}


long process(const std::string& input) {
    std::istringstream iss(input);
    std::string token;

   long a, b, c, x, y, z, m;

    while (iss >> token) {
        char key;
        long value;

        std::istringstream pairStream(token);
        pairStream >> key;
        pairStream.ignore();
        pairStream >> value;

        switch (key) {
            case 'A': a = value; break;
            case 'B': b = value; break;
            case 'C': c = value; break;
            case 'X': x = value; break;
            case 'Y': y = value; break;
            case 'Z': z = value; break;
            case 'M': m = value; break;
            default: std::cerr << "Unknown key: " << key << "\n";
        }
    }

    return longEmi(a, x, m) + longEmi(b, y, m) + longEmi(c, z, m);
}



int main() {
    long max = 0;
    for (const auto& line : input) {
        long val = process(std::string(line));
        if (val > max) {
            max = val;
        }
    }
    std::cout << max << std::endl;
    return 0;
}
